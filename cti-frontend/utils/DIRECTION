# Groth16 zkSNARK CTI Platform - Complete Workflow Summary

---

## **SYSTEM ARCHITECTURE**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND (Next.js + snarkjs)                               â”‚
â”‚  - Groth16 proof generation in browser (~10s)               â”‚
â”‚  - Poseidon commitment creation                             â”‚
â”‚  - ZKP visualization & education                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ L1 (ETH SEPOLIA) â”‚  â”‚ L2 (ARBITRUM SEPOLIA)    â”‚
â”‚ Public Only      â”‚  â”‚ Public + Anonymous       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Registry         â”‚  â”‚ Registry + MerkleZK      â”‚
â”‚ Governance (3/3) â”‚  â”‚ Governance (3/3)         â”‚
â”‚ Storage          â”‚  â”‚ Groth16Verifier          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  IPFS (Pinata)      â”‚
        â”‚  - IOC batches      â”‚
        â”‚  - Contributor tree â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **1. DEPLOYMENT PHASE**

```
Step 1: Deploy Base Contracts (Both Networks)
  L1 & L2:
  â”œâ”€â”€ PrivacyPreservingRegistry (public submissions + staking)
  â”œâ”€â”€ ThresholdGovernance (3/3 multi-sig approval)
  â””â”€â”€ StorageContribution (IPFS incentives)

Step 2: Generate Groth16 Circuit (One-Time)
  â”œâ”€â”€ Write contributor-proof.circom (Poseidon + Merkle constraints)
  â”œâ”€â”€ Compile: circom â†’ .wasm + .r1cs
  â”œâ”€â”€ Trusted Setup: Powers of Tau â†’ circuit_final.zkey
  â”œâ”€â”€ Export verifier: snarkjs â†’ Groth16Verifier.sol
  â””â”€â”€ Deploy Groth16Verifier to L2

Step 3: Deploy L2-Specific Contracts
  L2 only:
  â”œâ”€â”€ Groth16Verifier (auto-generated from circuit)
  â””â”€â”€ MerkleZKRegistry (links to Verifier + Registry)

Step 4: Start Automation Services
  â”œâ”€â”€ PM2: merkle-rebuilder (every 60s, rebuilds Poseidon tree)
  â””â”€â”€ PM2: oracle-service (every 24h, fetches AbuseIPDB)
```

**Outcome:** Dual-network system where L1 = public only, L2 = public + zkSNARK anonymous

---

## **2. CONTRIBUTOR LIFECYCLE**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REGISTRATION                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Action:
  1. Connect MetaMask to L2 (Arbitrum Sepolia)
  2. Select tier: MICRO (0.01) / STANDARD (0.05) / PREMIUM (0.1 ETH)
  3. Sign transaction: registry.registerContributor(tier)
  4. Wait 12 seconds for confirmation

On-Chain:
  - Store: contributor[address] = { tier, isActive: true, reputation: 0 }
  - Emit: ContributorRegistered(address, tier)
  - User can now submit PUBLIC batches immediately âœ…

Off-Chain (60 seconds later):
  - Merkle rebuilder detects event
  - Adds address to Poseidon contributor tree
  - Calls: merkleZK.updateContributorRoot(newRoot, count)
  - Uploads tree to IPFS + serves via /api/contributor-tree
  - User can now submit ANONYMOUS batches âœ…

Timeline:
  T+0s:   Registration complete â†’ Public mode active
  T+60s:  Tree updated â†’ Anonymous mode active
```

---

## **3. IOC SUBMISSION WORKFLOWS**

### **3A. PUBLIC SUBMISSION (L1 & L2)**

```
Frontend:
  1. User enters IOCs (one per line)
  2. Build keccak256 Merkle tree of IOCs
  3. Upload batch to IPFS â†’ get CID
  4. Calculate fee: 1% of gas cost with 2x margin (L1) or 1.5x (L2)
  5. Call: registry.addBatch(cid, iocRoot, true, dummyCommitment, 0x00)

Contract:
  1. Check: contributor is active
  2. Verify: msg.value >= requiredFee
  3. Store: batch[id] = { submitter: msg.sender, cid, iocRoot, isAccepted: false }
  4. Emit: BatchAdded(id, msg.sender, cid, root)

Cost: L1 = 0.004 ETH, L2 = 0.0008 ETH
Privacy: None (address visible)
```

---

### **3B. ANONYMOUS SUBMISSION (L2 ONLY - Groth16)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND - Proof Generation (10 seconds in browser)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Load Contributor Tree
  GET /api/contributor-tree
  â†’ { root, contributors: [...], proofs: [...] }
  Find: myProof = proofs.find(p => p.address == myAddress)
  Require: contributorCount >= 3 (for tree depth > 0)

Step 2: Generate Randomness
  const nonce = crypto.randomBytes(32);  // 256-bit entropy

Step 3: Compute Poseidon Commitment
  commitment = Poseidon([address, nonce])
  â†’ Unlinkable identifier

Step 4: Generate Groth16 Proof
  const { proof, publicSignals } = await snarkjs.groth16.fullProve(
    {
      // Public
      commitment: commitment,
      merkleRoot: treeData.root,
      
      // Private witness
      address: myAddress,
      nonce: nonce,
      merkleProof: myProof.siblings,    // Padded to 20
      pathIndices: myProof.pathBits      // Padded to 20
    },
    '/circuits/contributor-proof.wasm',
    '/circuits/circuit_final.zkey'
  );
  
  Output: (pA, pB, pC) - 3 curve points + [commitment, root]

Step 5: Upload IOCs
  Build keccak256 tree of IOCs
  Upload to IPFS â†’ CID

Step 6: Submit Transaction
  await merkleZK.submitBatchAnonymous(
    cid,
    iocMerkleRoot,
    proof.pA,
    proof.pB,
    proof.pC,
    publicSignals,
    { value: fee, gasLimit: 850000 }
  );


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONTRACT - Verification (~280k gas for pairing)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MerkleZKRegistry.submitBatchAnonymous():

Step 1: Validate Tree
  require(publicSignals[1] == contributorRoot, "Stale tree")

Step 2: Check Nullifier
  require(!usedCommitments[commitment], "Already used")

Step 3: Verify Groth16 Proof
  bool valid = groth16Verifier.verifyProof(pA, pB, pC, publicSignals)
  // Checks pairing equation on BN254 curve
  // Gas: ~280k (bn256Pairing precompile)
  require(valid, "Invalid zkSNARK")

Step 4: Verify Fee
  require(msg.value >= (gasCost * 1%) * 2, "Insufficient fee")

Step 5: Forward to Registry
  registry.addBatch(cid, iocRoot, false, commitment, encodedProof)
  â†’ Stored with submitter = address(0)

Step 6: Mark Used
  usedCommitments[commitment] = true

Step 7: Emit Event
  emit AnonymousBatchSubmitted(id, commitment, cid)

Total Gas: ~800k
Cost on L2: ~0.016 ETH
Cost on L1: ~0.24 ETH (why L2 only!)
```

---

## **4. GOVERNANCE WORKFLOW (3/3 Multi-Sig)**

```
Batch Approval (Public or Anonymous):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Admin 1:
  1. Reviews batch #23 (downloads from IPFS)
  2. Validates IOC quality
  3. Calls: governance.approveBatch(23)
  4. Contract: approvalCount[23] = 1, emit BatchApprovalAdded(23, admin1)

Admin 2:
  1. Reviews batch #23
  2. Validates independently
  3. Calls: governance.approveBatch(23)
  4. Contract: approvalCount[23] = 2

Admin 3:
  1. Reviews batch #23
  2. Calls: governance.approveBatch(23)
  3. Contract: approvalCount[23] = 3 â†’ THRESHOLD MET (3/3)
  
Auto-Execution:
  4. Contract calls: registry.acceptBatch(23)
  5. batch[23].isAccepted = true
  6. Reputation attribution:
     - If public: contributor[batch.submitter].reputation += tierBonus
     - If anonymous: proportional distribution to all tree members
  7. Emit: BatchAccepted(23), BatchExecuted(23)

Outcome:
  - Batch queryable by all users
  - Contributor(s) reputation increased
  - No single admin can approve alone (trustless)
```

---

## **5. AUTOMATED MERKLE TREE UPDATES**

```
PM2 Service: merkle-rebuilder (every 60 seconds)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Loop:
  1. Query: registry.ContributorRegistered events
  2. Extract: all active contributor addresses
  3. Build Poseidon tree:
     leaves = addresses.map(addr => Poseidon([addr]))
     tree = new MerkleTree(leaves, Poseidon)
     root = tree.getRoot()
  
  4. Generate proofs for each contributor:
     For i in 0 to N-1:
       proof[i] = tree.getProof(leaves[i])
       pathIndices[i] = binary_path(i, depth)
       pad to 20 levels (supports 1M contributors)
  
  5. Update contract:
     tx = merkleZK.updateContributorRoot(root, N)
     Gas: ~45k
  
  6. Save to file + IPFS:
     Save: contributor-merkle-tree.json
     Upload: pinata (backup)
     Serve: /api/contributor-tree (frontend fetches)
  
  7. Sleep 60 seconds
  8. Repeat

Result: New contributors get anonymous rights within 60s
```

---

## **6. DATA QUERY WORKFLOW**

```
User Searches IOC:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Frontend queries both networks:
   L1: registry.getBatchCount() â†’ for each batch, getBatch(i)
   L2: registry.getBatchCount() â†’ for each batch, getBatch(i)

2. Extract CIDs (skip if 0x... format)

3. Fetch from IPFS:
   GET https://gateway.pinata.cloud/ipfs/{cid}
   Fallbacks: cloudflare-ipfs.com, dweb.link

4. Parse IOCs and search:
   if (batch.iocs.includes(searchedIOC)) â†’ match found

5. Display results:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ IOC: evil.com                          â”‚
   â”‚ Batch: #23 (Arbitrum L2)               â”‚
   â”‚ Submitter: Anonymous (Commitment: 0x3f2a...)
   â”‚ Status: âœ… Approved (3/3 votes)        â”‚
   â”‚ Privacy: Hidden among 47 contributors  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6. Merkle Proof Verification:
   Generate proof for IOC in batch tree
   Call: registry.verifyIOC(23, leaf, proof)
   Display: âœ… Cryptographically verified
```

---

## **7. COMPLETE USER JOURNEY**

```
DAY 1 - ONBOARDING:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
08:00 - Register with 0.05 ETH stake (STANDARD tier)
08:00 - Public submission available immediately
08:01 - Merkle rebuilder detects registration (60s polling)
08:01 - Poseidon tree updated with new contributor
08:01 - Anonymous submission available âœ…

DAY 1 - SUBMISSION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
10:00 - Select ðŸ”’ Anonymous mode (L2 only)
10:00 - Enter 50 IOCs
10:00 - Click "Submit Anonymously"
10:01 - Browser generates Groth16 proof (10 seconds, progress bar shown)
10:01 - Upload to IPFS â†’ CID: QmXyZ...
10:01 - MetaMask prompt: 850k gas (~0.016 ETH on L2)
10:02 - Transaction confirmed
10:02 - Status: "âœ… Hidden among 47 contributors"
10:02 - Batch ID: 23, Submitter: Anonymous (Commitment: 0x3f2a...)

DAY 1 - GOVERNANCE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
14:00 - Admin 1 reviews batch #23 â†’ Approves (1/3)
15:00 - Admin 2 reviews batch #23 â†’ Approves (2/3)
16:00 - Admin 3 reviews batch #23 â†’ Approves (3/3) â†’ THRESHOLD MET
16:00 - Contract auto-executes: batch.isAccepted = true
16:00 - Reputation distributed proportionally to all 47 contributors
16:00 - Batch now queryable by all users

DAY 2 - QUERYING:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
09:00 - Another user searches "evil.com"
09:00 - Frontend finds in batch #23
09:00 - Shows: Anonymous submission, approved, 50 IOCs
09:00 - User verifies Merkle proof on-chain âœ…
```

---

## **8. KEY COMPONENTS**

### **Groth16 Circuit (contributor-proof.circom):**
```
Purpose: Prove "I'm a registered contributor" without revealing who

Inputs:
  Public:  commitment, merkleRoot
  Private: address, nonce, merkleProof[20], pathIndices[20]

Constraints:
  1. commitment == Poseidon(address, nonce)  // Binding
  2. Merkle path verification with Poseidon hashing
  3. Final hash == merkleRoot

Output: Proof that verifier can check in ~280k gas
```

### **Contributor Merkle Tree (Poseidon-based):**
```
Built by: PM2 service (every 60s)
Hash: Poseidon (zkSNARK-friendly, fewer constraints than keccak256)
Depth: 20 levels (supports 1,048,576 contributors)
Root: Stored on-chain in MerkleZKRegistry.contributorRoot

Structure:
              Root (on-chain)
             /              \
          H1                  H2
         /  \                /  \
       H3    H4            H5    H6
      / \   / \           / \   / \
    You Alice Bob Carol Dave Eve Frank ...

Your proof: [sibling1, sibling2, ..., up to root]
Gas to verify: ~280k (pairing precompile)
```

### **IOC Merkle Tree (keccak256-based):**
```
Built by: Frontend (per batch)
Hash: keccak256 (Ethereum native, cheap to verify)
Purpose: Prove IOC membership in batch

Structure:
              Root (stored in batch)
             /              \
          H1                  H2
         /  \                /  \
      evil.com  1.2.3.4   abc123  def456

Proof for "evil.com": [1.2.3.4_hash, H2]
Gas to verify: ~5k per sibling
```

**Two separate trees:** Contributor tree (Poseidon) for identity, IOC tree (keccak256) for data integrity.

---

## **9. PRIVACY GUARANTEES**

```
PUBLIC MODE:
  Privacy Level: 0%
  Address: Fully visible on-chain
  Gas Cost: ~200k (cheap)
  Use Case: Building reputation, non-sensitive data

ANONYMOUS MODE (Groth16):
  Privacy Level: Cryptographic zero-knowledge
  Address: Never revealed (commitment only)
  Anonymity: 1 in N (where N = contributor count)
  
  Properties:
  âœ… Zero-knowledge: Verifier learns NOTHING about identity
  âœ… Unlinkable: Different commitments per submission (random nonce)
  âœ… Non-interactive: One proof, no back-and-forth
  âœ… Provably secure: Relies on elliptic curve discrete log hardness
  
  Limitations:
  âš ï¸ Requires N >= 3 contributors (tree depth > 0)
  âš ï¸ 10-second proof generation (UX friction)
  âš ï¸ 4x higher gas cost (800k vs 200k)
  âš ï¸ Trusted setup dependency (ceremony security critical)
  âš ï¸ Reputation attribution requires off-chain indexer or proportional split
```

---

## **10. GOVERNANCE (3/3 Multi-Sig)**

```
Approval Process:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Batch submitted (public or anonymous) â†’ Status: Pending

Admin 1 reviews â†’ Clicks "Approve" â†’ approvalCount = 1/3
Admin 2 reviews â†’ Clicks "Approve" â†’ approvalCount = 2/3
Admin 3 reviews â†’ Clicks "Approve" â†’ approvalCount = 3/3 âœ…

Threshold Met (3/3):
  â†’ Contract auto-calls: registry.acceptBatch(batchId)
  â†’ batch.isAccepted = true
  â†’ Reputation awarded:
    - Public: contributor[batch.submitter].reputation += tierBonus
    - Anonymous: proportional to all tree members OR off-chain resolver
  â†’ Emit: BatchAccepted(batchId), BatchExecuted(batchId)

Outcome:
  - Batch now searchable
  - No single admin can approve alone (trustless)
  - Contributor(s) reputation increased
```

---

## **11. COST COMPARISON**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GAS COST ANALYSIS                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PUBLIC SUBMISSION:
  L1: 200k gas Ã— 20 Gwei = 0.004 ETH (~$8)
  L2: 200k gas Ã— 0.1 Gwei = 0.00002 ETH (~$0.04)

ANONYMOUS SUBMISSION (Groth16):
  L1: 800k gas Ã— 20 Gwei = 0.016 ETH (~$32) âŒ TOO EXPENSIVE
  L2: 800k gas Ã— 0.1 Gwei = 0.00008 ETH (~$0.16) âœ… AFFORDABLE

Gas Breakdown (Anonymous):
  - Groth16 verification (pairing): 280k
  - Proof point validation: 40k
  - Storage (batch + proof): 250k
  - Registry forwarding: 180k
  - Nullifier check: 50k
  Total: ~800k

Why L2 Only:
  200x gas price difference (L1: 20 Gwei, L2: 0.1 Gwei)
  Makes anonymous submission economically viable
```

---

## **12. REPUTATION & INCENTIVES**

```
Reputation Earning:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Public Batch Approved:
  â†’ contributor[address].reputation += tierBonus
  â†’ MICRO: +7, STANDARD: +10, PREMIUM: +15

Anonymous Batch Approved:
  â†’ Option A: Proportional distribution
    Each tree member gets: tierBonus / contributorCount
    With 47 contributors: 10 / 47 = +0.21 reputation each
    
  â†’ Option B: Off-chain resolver
    Indexer maps commitment â†’ address (via proof metadata)
    Award full reputation to identified contributor
    Requires storing (address, nonce) mapping off-chain

Reputation Loss:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Batch Rejected (3/3 votes):
  â†’ contributor.reputation -= tierPenalty
  â†’ MICRO: -3, STANDARD: -5, PREMIUM: -7

Slashing (governance decision):
  â†’ governance.slashContributor(address, amount)
  â†’ Removes stake, deactivates contributor
```

---

## **13. MINIMUM VIABLE REQUIREMENTS**

```
FOR ANONYMOUS SUBMISSIONS TO WORK:

âœ… Minimum 3 registered contributors (tree depth > 0)
âœ… Poseidon Merkle tree updated within last 60s
âœ… Connected to Arbitrum Sepolia L2
âœ… Circuit files deployed: .wasm, .zkey (35MB total)
âœ… Groth16Verifier contract deployed and linked
âœ… Balance >= 0.018 ETH (0.002 fee + 0.016 gas)
âœ… Browser supports WebAssembly
âœ… Contributor tree root matches on-chain storage
```

---

## **14. FINAL WORKFLOW SUMMARY**

```
CONTRIBUTOR FLOW:
1. Register (L2) â†’ Pay 0.01-0.1 ETH stake â†’ Public rights instant
2. Wait 60s â†’ Poseidon tree updated â†’ Anonymous rights granted
3. Submit public OR anonymous (10s Groth16 proof) â†’ Batch pending
4. 3 admins approve â†’ Batch accepted â†’ Reputation awarded
5. Repeat â†’ Build reputation â†’ Unlock higher tiers

DATA FLOW:
IOCs â†’ keccak256 tree â†’ IPFS â†’ On-chain (CID + root)
Identity â†’ Poseidon tree â†’ Groth16 proof â†’ On-chain (commitment)
Governance â†’ 3/3 votes â†’ Auto-execution â†’ Batch queryable

PRIVACY:
L1: Public only (address visible)
L2: Public (address visible) OR Anonymous (Groth16 zkSNARK)
    - Commitment = Poseidon(address, nonce)
    - Proof = BN254 curve points (pA, pB, pC)
    - Verification = Pairing equation check (~280k gas)
    - Anonymity = Cryptographic zero-knowledge (not statistical)

GOVERNANCE:
3/3 multi-sig approval required
All 3 admins must approve â†’ Batch accepted
Reputation distributed to contributor(s)
Trustless (no single authority)
```

---

**This is the complete corrected workflow for a TRUE Groth16 zkSNARK system with 3/3 DAO governance.**

 --- Answer from SAFUGPT: safugpt.secfdg.net